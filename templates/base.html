

<!doctype html>
<html lang="en">
<head>
  <!-- PWA: manifest + service worker -->
  <link rel="manifest" href="{{ url_for('manifest') }}">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("{{ url_for('sw') }}");
    }
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Hot Singles Chat{% endblock %}</title>

  <meta name="theme-color" content="#111111">
  <meta name="description" content="Live chat with singles. Real people, real time.">
  <link rel="icon" href="{{ url_for('static', filename='icon.png') }}">

  <!-- Site styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- Icons -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous"/>

  <!-- (Optional) Google AdSense -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5795465450797264"
    crossorigin="anonymous"></script>

  {% block extra_head %}{% endblock %}
</head>

<body class="site theme-dark" {% block body_data %}{% endblock %}>
  <header class="site-header">
    <a href="{{ url_for('landing') }}" class="brand">
      <span class="logo-dot"></span>
      <strong>HotSinglesChat</strong>
    </a>

    <nav class="nav">
      <a href="{{ url_for('landing') }}">Home</a>
      <a href="{{ url_for('privacy') }}">Privacy</a>
      <a href="{{ url_for('terms') }}">Terms</a>
      <a href="{{ url_for('cookies') }}">Cookies</a>
      <button id="themeToggle" class="btn subtle" type="button" title="Toggle theme">
        <i class="fa-solid fa-circle-half-stroke"></i>
      </button>
      <a class="btn primary" href="{{ url_for('login') }}">Enter Chat</a>
    </nav>
  </header>

  {% block content %}{% endblock %}

  <footer class="site-footer">
    <p>© {{ now().year if now else '' }} HotSinglesChat •
       <a href="{{ url_for('privacy') }}">Privacy</a> •
       <a href="{{ url_for('terms') }}">Terms</a> •
       <a href="{{ url_for('cookies') }}">Cookies</a>
    </p>
  </footer>

  <!-- Cookie banner -->
  <div id="cookie-banner" class="cookie-banner" hidden>
    <div class="cookie-inner">
      <p>We use cookies to keep you logged in and improve the experience.
         Read our <a href="{{ url_for('cookies') }}">Cookie Policy</a>.
      </p>
      <button id="cookie-accept" class="btn primary">Accept</button>
    </div>
  </div>

  <script>
    // Theme toggle (persisted)
    (function () {
      const key = "theme";
      const body = document.body;
      const btn = document.getElementById("themeToggle");
      const saved = localStorage.getItem(key);
      if (saved) body.className = "site " + saved;
      btn?.addEventListener("click", () => {
        const next = body.classList.contains("theme-dark") ? "theme-light" : "theme-dark";
        body.className = "site " + next;
        localStorage.setItem(key, next);
      });
    })();

    // Cookie consent
    (function () {
      const KEY = "cookie_ok=1";
      if (!document.cookie.includes("cookie_ok=")) {
        document.getElementById("cookie-banner").hidden = false;
        document.getElementById("cookie-accept").onclick = () => {
          document.cookie = KEY + "; Max-Age=" + (60*60*24*365) + "; path=/; SameSite=Lax";
          document.getElementById("cookie-banner").hidden = true;
        };
      }
    })();
    <!-- Age Gate (shared) -->
  <div id="age-gate" class="age-gate" hidden>
    <div class="age-gate-inner">
      <h2>Adults Only (18+)</h2>
      <p>This site may display adult advertising. By entering, you confirm you are 18+ and consent to cookies.</p>
      <button id="enterBtn" type="button" class="btn primary">Enter</button>
      <noscript class="noscript-warn">
        JavaScript is required to enter this site.
      </noscript>
    </div>
  </div>

  <script>
    // AGE GATE — shows only if the page opts in via body[data-agegate="on"]
    (function () {
      const wantsGate = (document.body.dataset.agegate || '').toLowerCase() === 'on';
      if (!wantsGate) return;

      const KEY  = 'age_ok';
      const gate = document.getElementById('age-gate');
      const btn  = document.getElementById('enterBtn');

      function hasConsent() {
        try {
          const ls = localStorage.getItem(KEY) === '1';
          const ck = document.cookie.split(';').some(c => c.trim().startsWith(KEY + '='));
          return ls || ck;
        } catch (_) {
          return document.cookie.split(';').some(c => c.trim().startsWith(KEY + '='));
        }
      }

      function setConsent(days = 30) {
        const maxAge = 60*60*24*days;
        // cookie for current host
        document.cookie = `${KEY}=1; Max-Age=${maxAge}; Path=/; SameSite=Lax`;
        // cookie for root domain (if applicable)
        const parts = location.hostname.split('.');
        if (parts.length >= 2) {
          const root = '.' + parts.slice(-2).join('.');
          document.cookie = `${KEY}=1; Max-Age=${maxAge}; Path=/; Domain=${root}; SameSite=Lax`;
        }
        try { localStorage.setItem(KEY, '1'); } catch(_) {}
      }

      if (hasConsent()) {
        gate.hidden = true;
        document.body.classList.remove('agelock');
      } else {
        gate.hidden = false;
        document.body.classList.add('agelock');
      }

      btn?.addEventListener('click', () => {
        setConsent(30);
        gate.hidden = true;
        document.body.classList.remove('agelock');
        setTimeout(() => { if (!hasConsent()) location.reload(); }, 50);
      });
    })();
  </script>
  </script>

  {% block extra_scripts %}{% endblock %}
</body>
  </html>
