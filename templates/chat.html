{% extends "base.html" %}

{% block title %}Chat Â· Hot Singles Chat{% endblock %}

{# Expose the role to chat.js via data attribute #}
{% block body_data %}data-role="{{ role|e }}"{% endblock %}

{% block extra_head %}
  <!-- Emoji picker (before chat.js uses it) -->
  <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@4.6.4/dist/index.min.js" crossorigin="anonymous"></script>
  <style>.agelock{overflow:hidden}</style>
{% endblock %}

{% block content %}
  <header class="topbar">
    <div>Logged in as <strong>{{ username|e }}</strong> ({{ role|e }})</div>
    <a class="btn" href="{{ url_for('logout') }}">Logout</a>
  </header>

  <main class="layout">
    <section class="panel">
      <h2>Online</h2>
      <ul id="users" class="users"></ul>
    </section>

    <section class="panel">
      <ul id="messages" class="messages"></ul>

      <form id="sendForm" class="send">
        <input id="msgInput" placeholder="Type a message" autocomplete="off">
        <button type="submit">Send</button>
      </form>

      <!-- Back to chat button (shown when DMing) -->
      <button id="backToChat" style="display:none;">Back to Public Chat</button>
    </section>
  </main>

  <!-- Age Gate -->
  <div id="age-gate" class="age-gate">
    <div class="age-gate-inner">
      <h2>Adults Only (18+)</h2>
      <p>This site may display adult advertising. By entering, you confirm you are 18+ and consent to cookies.</p>
      <button id="enterBtn" type="button" class="btn primary">Enter</button>
      <noscript class="noscript-warn">
        JavaScript is required to enter this site.
      </noscript>
    </div>
  </div>
{% endblock %}

{% block extra_scripts %}
  <!-- Socket.IO client + role exposure for chat.js -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
  <script>window.ROLE = document.body.dataset.role || 'user';</script>

  <!-- Chat logic (expects #users, #messages, #sendForm, #msgInput, #backToChat) -->
  <script src="{{ url_for('static', filename='chat.js') }}"></script>

{% endblock %}
